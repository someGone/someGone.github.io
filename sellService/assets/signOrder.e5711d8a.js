var U=Object.defineProperty;var T=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var V=(a,s,o)=>s in a?U(a,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[s]=o,O=(a,s)=>{for(var o in s||(s={}))E.call(s,o)&&V(a,o,s[o]);if(T)for(var o of T(s))N.call(s,o)&&V(a,o,s[o]);return a};import{_ as j,r as _,o as n,h as i,d as v,b as r,w as I,z as P,i as y,j as k,t as l,k as h,g as Z,q as B,p as z,f as A,l as R,A as G,F as M,B as q,c as w,e as b,E as F}from"./index.4f81b99f.js";import{N as J}from"./hh-nav.705063b4.js";import{h as K}from"./html2canvas.esm.3d083717.js";import{d as Q,u as W}from"./aliOSS.f9948a28.js";import{u as X}from"./index.18040514.js";import"./_commonjsHelpers.88e99c8f.js";const Y={components:{NavBar:J},setup(){var a=0;const s=_(""),o=_(!1),t=_(-1),p=_("");var u=_([]);const x=()=>{history.back()},{proxy:g}=Z(),S=_("0"),f=_(),C=!1,e=_([{name:"\u5065\u8EAB\u623F\u8BE6\u7EC6\u540D\u79F0",value:"",placeholder:"\u8BF7\u8F93\u5165\u5065\u8EAB\u623F\u540D\u79F0"},{name:"\u8054\u7CFB\u4EBA",value:"",placeholder:"\u8BF7\u8F93\u5165\u8054\u7CFB\u4EBA\u59D3\u540D"},{name:"\u7535\u8BDD",value:"",placeholder:"\u8BF7\u8F93\u5165\u8054\u7CFB\u4EBA\u7535\u8BDD"},{name:"\u8BE6\u7EC6\u5730\u5740",value:"",placeholder:"\u8BF7\u8F93\u5165\u5065\u8EAB\u623F\u8BE6\u7EC6\u5730\u5740"},{name:"\u8425\u4E1A\u6267\u7167\u7F16\u53F7",value:"",placeholder:"\u8BF7\u8F93\u5165\u5065\u8EAB\u623F\u8425\u4E1A\u6267\u7167\u7F16\u53F7"},{name:"\u7B7E\u7EA6\u65F6\u957F",value:"",placeholder:"\u8BF7\u8F93\u5165\u7B7E\u7EA6\u65F6\u957F",type:1,unit:"\u5E74"},{name:"\u7B7E\u5355\u91D1\u989D",value:"",placeholder:"\u8BF7\u8F93\u5165\u7B7E\u5355\u91D1\u989D",type:1,unit:"\u5143"},{name:"\u524D5\u4E2A\u6708\u5151\u6362\u7801\u6BCF\u6708\u8D60\u9001\u6570\u91CF",value:"",placeholder:"\u8BF7\u8F93\u5165\u8D60\u9001\u6570\u91CF",type:1,unit:"\u4E2A"}]),c=_([]),{toClipboard:m}=X();return{onClickLeft:x,gymId:0,stepIndex:a,orderInput:e,markInfo:s,canOrder:o,orderState:t,steps:u,orderImgBase64:p,proxy:g,hardwareList:c,orderTotalPrice:S,orderInfo:f,isReInputOrder:C,copy:async L=>{try{var D=await m(L);return D}catch(H){return console.error(H),!1}}}},data(){return{checkTimer:null}},mounted(){const{gymId:a}=O({},this.$route.query);this.gymId=a,this.getGymSignOrderData(),this.checkTimer=setInterval(()=>{var s=0;this.hardwareList.map(g=>{s+=g.unitPrice*g.count});let o=parseInt(this.orderInput[6].value==""?0:this.orderInput[6].value)+s;this.orderTotalPrice=o.toString();for(var t=!0,p=0;p<this.orderInput.length;p++){var u=this.orderInput[p];for(var x in u)x=="value"&&u[x]==""&&(t=!1)}this.canOrder=t},1e3)},unmounted(){clearInterval(this.checkTimer)},methods:{getGymSignOrderData(){this.proxy.$api.getGymSignOrder(this.gymId).then(a=>{this.orderInfo=a.data,this.orderState=a.data.state,this.orderInput[0].value=this.orderInfo.company_name,this.orderInput[1].value=this.orderInfo.contact_name,this.orderInput[2].value=this.orderInfo.contact_phone,this.orderInput[3].value=this.orderInfo.address,this.orderInput[4].value=this.orderInfo.license_no,this.orderInput[5].value=this.orderInfo.sign_duration,this.orderInput[6].value=parseInt(this.orderInfo.sign_price),this.orderInput[7].value=this.orderInfo.each_month_coupon_quantity,this.markInfo=a.data.remark,this.isReInputOrder=!1,this.hardwareList=this.orderInfo.products.map(s=>{var o={name:s.name,count:s.amount,unitPrice:s.unit_price};return o}),this.getStepData(),a.data.state>=3&&a.data.state<=5&&this.orderInfo.contract_img==null?setTimeout(()=>{this.onExport()},1500):this.orderImgBase64=this.orderInfo.contract_img}).catch(a=>{a.code==422&&(this.orderState=-1,this.getStepData(),this.getHardwareInfo())})},getStepData(){this.orderState==-1?(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u4E2D","\u7B7E\u5408\u540C","\u6253\u6B3E"],this.stepIndex=0):this.orderState==1?(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u4E2D","\u7B7E\u5408\u540C","\u6253\u6B3E"],this.stepIndex=1):this.orderState==2?(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u672A\u901A\u8FC7","\u7B7E\u5408\u540C","\u6253\u6B3E"],this.stepIndex=1):this.orderState==3?(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u901A\u8FC7","\u53D1\u9001\u5408\u540C","\u6253\u6B3E"],this.stepIndex=2):this.orderState==4?(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u901A\u8FC7","\u53D1\u9001\u5408\u540C","\u6253\u6B3E"],this.stepIndex=2):this.orderState==5||this.orderState==6?(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u901A\u8FC7","\u5408\u540C\u5B8C\u6210","\u7B49\u5F85\u6253\u6B3E"],this.stepIndex=3):this.orderState==7&&(this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u901A\u8FC7","\u5408\u540C\u5B8C\u6210","\u5DF2\u6253\u6B3E"],this.stepIndex=3)},getHardwareInfo(){this.proxy.$api.signOrderHardwarePrice().then(a=>{console.log("\u786C\u4EF6",a);var s=a.data;this.hardwareList=s.map(o=>{var t={name:o.name,count:0,unitPrice:o.unitPrice};return t})})},orderClick(){var a=!0;if(this.orderInput.map(t=>{t.value==""&&(a=!1)}),!a){this.$toast("\u8BF7\u5B8C\u5584\u4FE1\u606F\u540E\u518D\u63D0\u4EA4");return}if(this.isReInputOrder){this.updateSignOrder();return}var s=this.hardwareList.map(t=>({name:t.name,amount:parseInt(t.count),unitPrice:parseInt(t.unitPrice)})),o={companyName:this.orderInput[0].value,contactName:this.orderInput[1].value,contactPhone:this.orderInput[2].value,address:this.orderInput[3].value,licenseNo:this.orderInput[4].value,signDuration:parseInt(this.orderInput[5].value),signPrice:parseInt(this.orderInput[6].value),giftCouponMonth:5,eachMonthCouponQuantity:parseInt(this.orderInput[7].value),totalPrice:parseInt(this.orderTotalPrice),remark:this.markInfo,products:s};this.proxy.$api.createGymSignOrder(this.gymId,o).then(t=>{this.getGymSignOrderData()})},reInputClick(){this.$dialog.confirm({title:"\u7B7E\u5355",message:"\u8BF7\u786E\u5B9A\u662F\u5426\u91CD\u65B0\u586B\u62A5\u6B64\u95E8\u5E97\u7B7E\u5355?"}).then(()=>{this.stepIndex=0,this.orderState=-1,this.isReInputOrder=!0,this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u4E2D","\u7B7E\u5408\u540C","\u6253\u6B3E"]}).catch(()=>{})},updateSignOrder(){var a=this.hardwareList.map(o=>({name:o.name,amount:parseInt(o.count),unitPrice:parseInt(o.unitPrice)})),s={companyName:this.orderInput[0].value,contactName:this.orderInput[1].value,contactPhone:this.orderInput[2].value,address:this.orderInput[3].value,licenseNo:this.orderInput[4].value,signDuration:parseInt(this.orderInput[5].value),signPrice:parseInt(this.orderInput[6].value),giftCouponMonth:5,eachMonthCouponQuantity:parseInt(this.orderInput[7].value),totalPrice:parseInt(this.orderTotalPrice),remark:this.markInfo,products:a};this.proxy.$api.updateGymSignOrder(this.orderInfo.id,s).then(o=>{this.$toast("\u91CD\u65B0\u586B\u62A5\u7B7E\u5355\u6210\u529F"),this.getGymSignOrderData()})},onExport(){K(this.$refs.imageWrapper,{useCORS:!0,logging:!0}).then(a=>{const s=a.toDataURL("image/png");this.orderImgBase64=s,this.stepIndex=2,this.steps=["\u63D0\u62A5\u7B7E\u5355","\u5BA1\u6838\u901A\u8FC7","\u53D1\u9001\u5408\u540C","\u6253\u6B3E"];const o="exercise/gymSell/gymImgs/contractImg/"+this.orderInfo.id.toString()+".jpg";var t=Q(s,o);W(o,t).then(p=>{console.log("\u4E0A\u4F20\u6210\u529F");var u={contractImg:"https://zkyk-gym.oss-cn-guangzhou.aliyuncs.com/"+o};this.proxy.$api.sendSignContract(this.orderInfo.id,u).then(x=>{this.getGymSignOrderData()})}).catch(p=>{console.log("\u4E0A\u4F20\u5931\u8D25",p)})})},sendElectronicContract(){var a={contractImg:this.orderInfo.contract_img};this.proxy.$api.sendSignContract(this.orderInfo.id,a).then(async s=>{const o=s.data,t="localhost:3000/contractSign?token="+o+`&id=${this.gymId}&orderId=${this.orderInfo.id}`;var p=await this.copy(t);p&&this.$toast("\u5408\u540C\u5730\u5740\u590D\u5236\u6210\u529F,\u8BF7\u5FAE\u4FE1\u53D1\u9001\u7ED9\u7B7E\u5408\u540C\u7684\u5BA2\u6237")})},sendOrderToOther(){this.proxy.$api.getShortToken(this.orderInfo.id).then(async a=>{const s=a.data;var o="https://gol.mynatapp.cc/pay?token="+s+`&gymId=${this.gymId}&orderId=${this.orderInfo.id}`,t=await this.copy(o);t&&this.$toast("\u8BA2\u5355\u5730\u5740\u590D\u5236\u6210\u529F,\u8BF7\u5FAE\u4FE1\u53D1\u9001\u7ED9\u7B7E\u5408\u540C\u7684\u5BA2\u6237")})},getAndInitJSSDKAndShare(a){this.proxy.$api.getJSSDKConfig().then(s=>{console.log(s.data.appId)}),wx.config({debug:!0,appId:"wx15d89d1b4bf9c60c",timestamp:"1618020077",nonceStr:"dwajndnkwajdwajnmmzxmoi",signature:"8fc64853bfbaf6b004560f6bff84e878edd1b9ec",jsApiList:["updateAppMessageShareData"]}),wx.ready(()=>{console.log("wx.ready"),wx.updateAppMessageShareData({title:"\u5408\u540C\u7B7E\u7F72",desc:"",link:"https://www.zkyunkang.com/",imgUrl:"",success:function(){}})}),wx.error(function(s){console.log("config fail123:",s)})}}},d=a=>(z("data-v-74a3e3f8"),a=a(),A(),a),$={class:"mainPage van-safe-area-top"},tt={class:"container"},et={key:0},st={class:"mt20 ml20 mr20"},rt={class:"norText w30"},at={key:0,class:"justColumnEnd flex1"},ot=d(()=>r("div",{class:"wLine",style:{"--z":"90%"}},null,-1)),nt={key:1,class:"justColumnEnd"},it=d(()=>r("div",{class:"wLine",style:{"--z":"90%"}},null,-1)),dt={key:2},lt=B('<text class="regText ml20 mt20" style="--c:rgba(91, 143, 249, 1);" data-v-74a3e3f8>*\u7B7E\u5355\u6210\u529F\u540E\u7B2C\u4E00\u4E2A\u6708\u5151\u6362\u7801\u65E0\u9650\u91CF\u4F9B\u5E94</text><div class="marginV" style="--mH:16px;" data-v-74a3e3f8></div><div class="rowAround mtCustom" data-v-74a3e3f8><text class="norText w30" style="--fZ:14px;--c:rgba(102, 102, 102, 1);" data-v-74a3e3f8>\u786C\u4EF6\u540D\u79F0</text><text class="norText w30" style="--fZ:14px;--c:rgba(102, 102, 102, 1);" data-v-74a3e3f8>\u6570\u91CF/\u4E2A</text><text class="norText w30" style="--fZ:14px;--c:rgba(102, 102, 102, 1);" data-v-74a3e3f8>\u4EF7\u683C/\u5143</text></div>',3),ct={class:"regText w30",style:{"--fZ":"14px"}},ht={key:0,class:"norText w30",style:{"--fZ":"14px"}},ut={key:2,class:"norText w30",style:{"--fZ":"14px"}},pt=d(()=>r("div",{class:"marginV",style:{"--mH":"16px"}},null,-1)),mt={class:"rowSpace ml20 mr20"},_t=d(()=>r("text",{class:"norText"},"\u603B\u91D1\u989D",-1)),vt={class:"bigText"},gt={class:"justRow ml20 mr20 mt20"},It=d(()=>r("text",{class:"norText w30"},"\u5907\u6CE8",-1)),xt={class:"justColumnEnd flex1"},ft=d(()=>r("div",{class:"wLine",style:{"--z":"90%"}},null,-1)),yt={key:0},kt=d(()=>r("div",{class:"marginV",style:{"--mH":"28px"}},null,-1)),St=d(()=>r("text",{class:"bigText ml20",style:{"--c":"rgba(232, 102, 81, 1)"}},"\u5BA1\u6838\u672A\u901A\u8FC7\u539F\u56E0",-1)),wt=d(()=>r("div",{class:"marginV",style:{"--mH":"0px"}},null,-1)),bt={class:"regText ml20",style:{"--c":"rgba(232, 102, 81, 1)"}},Ct={key:1,class:"oneCenter mtCustom",style:{"--z":"36px"}},Tt=b("\u5B8C\u6210\u5E76\u586B\u62A5"),Vt={key:2,class:"oneCenter mtCustom",style:{"--z":"36px"}},Ot=b("\u91CD\u65B0\u586B\u62A5"),Pt={key:1},Bt={class:"mt20 ml20 mr20"},Lt=d(()=>r("div",{class:"marginV",style:{"--mH":"24px"}},null,-1)),Dt=d(()=>r("text",{class:"bigText oneCenter"},"\u5408\u540C\u9884\u89C8",-1)),Ht=d(()=>r("div",{class:"marginV",style:{"--mH":"16px"}},null,-1)),Ut={class:"orderLookImgV"},Et=["src"],Nt=d(()=>r("div",{class:"marginV",style:{"--mH":"60px"}},null,-1)),jt={key:0,class:"bottomBtn"},Zt={key:2},zt={class:"mt20 ml20 mr20"},At={key:0},Rt=d(()=>r("div",{class:"marginV",style:{"--mH":"24px"}},null,-1)),Gt=d(()=>r("text",{class:"oneCenter bigText"},"\u7B7E\u5355\u8BE6\u60C5",-1)),Mt=d(()=>r("div",{class:"marginV",style:{"--mH":"16px"}},null,-1)),qt=[Rt,Gt,Mt],Ft={class:"regText w30",style:{"--c":"#1b1b1b"}},Jt={key:0,class:"justColumnEnd flex1"},Kt={class:"norText rowEnd",style:{"--c":"#1b1b1b"}},Qt={key:1,class:"justColumnEnd flex1"},Wt={class:"norText rowEnd",style:{"--c":"#1b1b1b"}},Xt=B('<div class="marginV" style="--mH:16px;" data-v-74a3e3f8></div><div class="rowAround mtCustom" data-v-74a3e3f8><text class="norText w30 tInC" style="--fZ:14px;--c:rgba(102, 102, 102, 1);" data-v-74a3e3f8>\u786C\u4EF6\u540D\u79F0</text><text class="norText w30 tInC" style="--fZ:14px;--c:rgba(102, 102, 102, 1);" data-v-74a3e3f8>\u6570\u91CF/\u4E2A</text><text class="norText w30 tInC" style="--fZ:14px;--c:rgba(102, 102, 102, 1);" data-v-74a3e3f8>\u4EF7\u683C/\u5143</text></div>',2),Yt={class:"regText w30 tInC",style:{"--fZ":"14px"}},$t={class:"norText w30 tInC",style:{"--fZ":"14px"}},te={class:"norText w30 tInC",style:{"--fZ":"14px"}},ee=d(()=>r("div",{class:"marginV",style:{"--mH":"16px"}},null,-1)),se={class:"rowSpace ml20 mr20"},re=d(()=>r("text",{class:"bigText"},"\u603B\u91D1\u989D",-1)),ae={class:"bigText"},oe=d(()=>r("div",{class:"marginV borderInB",style:{"--mH":"16px"}},null,-1)),ne={key:0,class:"bottomBtn"};function ie(a,s,o,t,p,u){const x=R("nav-bar"),g=F,S=G,f=M,C=q;return n(),i("div",$,[v(x,{text:"\u7B7E\u5355",onBlackclick:t.onClickLeft,isblack:!0,issearch:!1},null,8,["onBlackclick"]),r("div",tt,[t.orderState<3||t.orderState==3&&t.orderImgBase64==""?(n(),i("div",et,[r("div",st,[v(S,{active:t.stepIndex,"active-icon":t.orderState==2?"close":"passed","active-color":t.orderState==2?"rgba(255,0,0,1)":"rgba(91, 143, 249, 1)"},{default:I(()=>[(n(!0),i(y,null,k(t.steps,(e,c)=>(n(),w(g,{key:c},{default:I(()=>[b(l(e),1)]),_:2},1024))),128))]),_:1},8,["active","active-icon","active-color"])]),r("div",{class:P(t.orderState==2?"op4":""),ref:"imageWrapper"},[(n(!0),i(y,null,k(t.orderInput,(e,c)=>(n(),i("div",{key:c,class:"justRow ml20 mr20 mt20"},[r("text",rt,l(e.name),1),e.type!=1?(n(),i("div",at,[v(f,{modelValue:e.value,"onUpdate:modelValue":m=>e.value=m,placeholder:e.placeholder,disabled:t.orderState!=-1},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),ot])):h("",!0),e.type==1?(n(),i("div",nt,[v(f,{modelValue:e.value,"onUpdate:modelValue":m=>e.value=m,placeholder:e.placeholder,disabled:t.orderState!=-1},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),it])):h("",!0),e.type==1?(n(),i("text",dt,l(e.unit),1)):h("",!0)]))),128)),lt,(n(!0),i(y,null,k(t.hardwareList,(e,c)=>(n(),i("div",{class:"rowAround clearC",key:c},[r("text",ct,l(e.name),1),t.orderState!=-1?(n(),i("text",ht,l(e.count),1)):(n(),w(f,{key:1,maxlength:"4",class:"hardwareCount",modelValue:e.count,"onUpdate:modelValue":m=>e.count=m,type:"number",required:"",placeholder:"\u8BF7\u8F93\u5165\u6570\u91CF"},null,8,["modelValue","onUpdate:modelValue"])),t.orderState!=-1?(n(),i("text",ut,l(e.unitPrice),1)):(n(),w(f,{key:3,maxlength:"8",class:"hardwareCount",modelValue:e.unitPrice,"onUpdate:modelValue":m=>e.unitPrice=m,type:"number",required:"",placeholder:"\u8BF7\u8F93\u5165\u6570\u91CF"},null,8,["modelValue","onUpdate:modelValue"]))]))),128)),pt,r("div",mt,[_t,r("text",vt,"\xA5 "+l(t.orderTotalPrice)+" \u5143",1)]),r("div",gt,[It,r("div",xt,[v(f,{modelValue:t.markInfo,"onUpdate:modelValue":s[0]||(s[0]=e=>t.markInfo=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8(\u9009\u586B)"},null,8,["modelValue"]),ft])])],2),t.orderState==2?(n(),i("div",yt,[kt,St,wt,r("text",bt,l(this.orderInfo.audit_reason),1)])):h("",!0),t.orderState==-1?(n(),i("div",Ct,[v(C,{onClick:u.orderClick,class:P(t.canOrder?"submitBtn":"submitBtnDisabled")},{default:I(()=>[Tt]),_:1},8,["onClick","class"])])):h("",!0),t.orderState==2?(n(),i("div",Vt,[v(C,{onClick:u.reInputClick,class:"submitBtn"},{default:I(()=>[Ot]),_:1},8,["onClick"])])):h("",!0)])):h("",!0),t.orderState==4||t.orderState==5?(n(),i("div",Pt,[r("div",Bt,[v(S,{active:t.stepIndex,"active-icon":"passed","active-color":"rgba(91, 143, 249, 1)"},{default:I(()=>[(n(!0),i(y,null,k(t.steps,(e,c)=>(n(),w(g,{key:c},{default:I(()=>[b(l(e),1)]),_:2},1024))),128))]),_:1},8,["active"])]),Lt,Dt,Ht,r("div",Ut,[r("img",{src:t.orderImgBase64,class:"orderImg"},null,8,Et)]),Nt,t.orderState!=5?(n(),i("div",jt,[r("text",{class:"boBtn2",onClick:s[1]||(s[1]=(...e)=>u.sendElectronicContract&&u.sendElectronicContract(...e))},"\u53D1\u9001\u7535\u5B50\u5408\u540C")])):h("",!0)])):h("",!0),t.orderState>=5?(n(),i("div",Zt,[r("div",zt,[v(S,{active:t.stepIndex,"active-icon":"passed","active-color":"rgba(91, 143, 249, 1)"},{default:I(()=>[(n(!0),i(y,null,k(t.steps,(e,c)=>(n(),w(g,{key:c},{default:I(()=>[b(l(e),1)]),_:2},1024))),128))]),_:1},8,["active"])]),t.orderState>=6?(n(),i("div",At,qt)):h("",!0),(n(!0),i(y,null,k(t.orderInput,(e,c)=>(n(),i("div",{key:c,class:"justRow ml20 mr20 mt20"},[r("text",Ft,l(e.name),1),e.type!=1?(n(),i("div",Jt,[r("text",Kt,l(e.value),1)])):h("",!0),e.type==1?(n(),i("div",Qt,[r("text",Wt,l(e.value+e.unit),1)])):h("",!0)]))),128)),Xt,(n(!0),i(y,null,k(t.hardwareList,(e,c)=>(n(),i("div",{class:"rowAround clearC",key:c},[r("text",Yt,l(e.name),1),r("text",$t,l(e.count),1),r("text",te,l(e.unitPrice),1)]))),128)),ee,r("div",se,[re,r("text",ae,"\xA5 "+l(t.orderTotalPrice)+" \u5143",1)]),oe])):h("",!0)]),t.orderState>5?(n(),i("div",ne,[r("text",{class:"boBtn2",onClick:s[2]||(s[2]=(...e)=>u.sendOrderToOther&&u.sendOrderToOther(...e))},"\u53D1\u9001\u8BA2\u5355")])):h("",!0)])}var ve=j(Y,[["render",ie],["__scopeId","data-v-74a3e3f8"]]);export{ve as default};
